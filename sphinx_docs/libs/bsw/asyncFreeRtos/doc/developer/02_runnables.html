<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta content="EclipseOpenBSWDocumentation" name="dox_trace_storage" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Runnables &mdash; Eclipse OpenBSW Documentation  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/rtd_theme_overrides.css?v=6fd0d55b" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/graphviz.css?v=eafc0fe6" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/colors.css?v=3cafd8aa" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/colored_table.css?v=34b816d5" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/header.css?v=e632285e" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/dox_util_colors.css?v=dd14b177" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/dox_trace.css?v=60d3f72c" />

  
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../../../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../../../../_static/copybutton.js?v=f281be69"></script>
        <script src="../../../../../_static/dox_trace.js?v=40719b51"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <link rel="next" title="User Documentation" href="../user/index.html" />
    <link rel="prev" title="Initialization and Task Creation" href="01_initialization.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../doc/index.html" class="icon icon-home">
            Eclipse OpenBSW Documentation
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Learning</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/learning/overview.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/learning/SysTest/HW_Testing_Guide.html">Hardware Testing Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Guidelines</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/guidelines/conventions/index.html">Coding Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/guidelines/practices.html">Coding Practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/guidelines/3rdparty.html">Third Party Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/guidelines/codeFormatting/index.html">Code Formatting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Platforms</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/platforms/posix/index.html">POSIX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/platforms/s32k148evb/index.html">S32K148 Evaluation Board</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Features</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/features/storage.html">Persistent Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/features/functional_safety.html">Functional Safety</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Software Modules</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../../../doc/modules/common.html">Common</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../../../../doc/modules/common.html#bsw">BSW</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../../async/doc/index.html">async - Asynchronous Execution Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../asyncConsole/doc/index.html">asyncConsole - Asynchronous Console</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">asyncFreeRtos</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="index.html">Developer Documentation</a><ul class="current">
<li class="toctree-l5"><a class="reference internal" href="01_initialization.html">Initialization and Task Creation</a></li>
<li class="toctree-l5 current"><a class="current reference internal" href="#">Runnables</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../user/index.html">User Documentation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../asyncImpl/doc/index.html">asyncImpl</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../bsp/doc/index.html">bsp</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../common/doc/index.html">common</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cpp2can/doc/index.html">cpp2can - CAN Abstraction Layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cpp2ethernet/doc/index.html">cpp2ethernet - Ethernet Abstractions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../docan/doc/index.html">docan - Diagnostics over CAN</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../io/doc/index.html">io - IO Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../lifecycle/doc/index.html">lifecycle - App Lifecycle Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../logger/doc/index.html">logger - Logger module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../loggerIntegration/doc/index.html">loggerIntegration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../lwipSocket/doc/index.html">lwipSocket - LwIP v2 Socket Abstraction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../platform/doc/index.html">platform - Platform Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../runtime/doc/index.html">runtime</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stdioConsoleInput/doc/index.html">stdioConsoleInput</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../storage/doc/index.html">storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../timer/doc/index.html">timer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../transport/doc/index.html">transport - Transport Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../transportRouterSimple/doc/index.html">transportRouterSimple</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../uds/doc/index.html">uds - Unified Diagnostic Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../util/doc/index.html">util</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../doc/modules/common.html#bsp">BSP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../doc/modules/common.html#safety">Safety</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/modules/posix.html">Posix</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/modules/s32k1xx.html">S32K1xx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/modules/executables.html">Executables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/modules/mocks.html">Mocks</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../tools/UdsTool/doc/index.html">UdsTool</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../tools/puncover_tool/doc/index.html">Puncover</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../doc/index.html">Eclipse OpenBSW Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../doc/index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../../../doc/modules/common.html">Common</a> &raquo;</li>
        
          <li><a href="../index.html">asyncFreeRtos</a> &raquo;</li>
        
          <li><a href="index.html">Developer Documentation</a> &raquo;</li>
        
        <li>Runnables</li>
    

    

      <li class="wy-breadcrumbs-aside">

        <!-- DOCUMENT STATUS -->

        

        <!-- DATA CLASSIFICATION -->

        

      </li>

    
  </ul>

  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="runnables">
<span id="id1"></span><h1>Runnables<a class="headerlink" href="#runnables" title="Link to this heading"></a></h1>
<p>The previous section we focused on the initialization of the system at runtime up to the point where
the user can use the <em>async</em> API to schedule runnables within the created tasks. We now want to look
into some details on how this is implemented internally and which <em>FreeRTOS</em> functionalities we use.
Also here, let’s take a look into a simple usage example as shown below.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kt">void</span><span class="w"> </span><span class="nf">startApp</span><span class="p">()</span>
<span class="linenos">2</span><span class="p">{</span>
<span class="linenos">3</span><span class="w">    </span><span class="o">::</span><span class="n">async</span><span class="o">::</span><span class="n">execute</span><span class="p">(</span><span class="n">TASK_EXAMPLE</span><span class="p">,</span><span class="w"> </span><span class="n">runnable</span><span class="p">);</span>
<span class="linenos">4</span><span class="w">    </span><span class="o">::</span><span class="n">async</span><span class="o">::</span><span class="n">schedule</span><span class="p">(</span><span class="n">TASK_EXAMPLE</span><span class="p">,</span><span class="w"> </span><span class="n">runnable</span><span class="p">,</span><span class="w"> </span><span class="n">timeout</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">::</span><span class="n">async</span><span class="o">::</span><span class="n">TimeUnit</span><span class="o">::</span><span class="n">SECONDS</span><span class="p">);</span>
<span class="linenos">5</span><span class="w">    </span><span class="o">::</span><span class="n">async</span><span class="o">::</span><span class="n">scheduleAtFixedRate</span><span class="p">(</span><span class="n">TASK_EXAMPLE</span><span class="p">,</span><span class="w"> </span><span class="n">runnable</span><span class="p">,</span><span class="w"> </span><span class="n">timeout</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">::</span><span class="n">async</span><span class="o">::</span><span class="n">TimeUnit</span><span class="o">::</span><span class="n">SECONDS</span><span class="p">);</span>
<span class="linenos">6</span><span class="p">}</span>
</pre></div>
</div>
<p>It shows the main three API functions provided by <em>async</em> which allow to schedule a runnable in a
given task identified by its integer id (in our case again an enum value). To find out the task
object by its integer id we utilize the previously described <code class="code docutils literal notranslate"><span class="pre">_taskContexts</span></code> array and call
the belonging method on it.</p>
<p>Before looking into the concrete implementation of the different API calls, let’s first have a quick
look into the <code class="code docutils literal notranslate"><span class="pre">TaskContext::dispatch</span></code> function, which is by default the task entry function of
the created <em>FreeRTOS</em> task (ignoring the calls through <code class="code docutils literal notranslate"><span class="pre">TaskContext::staticTaskFunction</span></code>,
<code class="code docutils literal notranslate"><span class="pre">TaskContext::callTaskFunction</span></code> and <code class="code docutils literal notranslate"><span class="pre">defaultTaskFunction</span></code>).</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="n">TaskContext</span><span class="o">&lt;</span><span class="n">Binding</span><span class="o">&gt;::</span><span class="n">dispatch</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">EventMaskType</span><span class="w"> </span><span class="n">eventMask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0U</span><span class="p">;</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">((</span><span class="n">eventMask</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">STOP_EVENT_MASK</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0U</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">eventMask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">waitEvents</span><span class="p">();</span>
<span class="w">        </span><span class="n">handleEvents</span><span class="p">(</span><span class="n">eventMask</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As you can see, it is simply an endless loop waiting for events and handling them. The term event
here is mapped to the <em>FreeRTOS</em> concept of task notifications which can be triggered by
<code class="code docutils literal notranslate"><span class="pre">xTaskNotify</span></code> or waited for using <code class="code docutils literal notranslate"><span class="pre">xTaskNotifyWait</span></code>. The latter one releases the task
and gives control back to the scheduler to allow other tasks to be executed. We currently use two of
these events as can be seen by the <code class="code docutils literal notranslate"><span class="pre">EventPolicy</span></code> types aliases declared.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">ExecuteEventPolicyType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EventPolicy</span><span class="o">&lt;</span><span class="n">TaskContext</span><span class="o">&lt;</span><span class="n">Binding</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="mi">0U</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="n">TimerEventPolicyType</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">EventPolicy</span><span class="o">&lt;</span><span class="n">TaskContext</span><span class="o">&lt;</span><span class="n">Binding</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="mi">1U</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>
</div>
<p>For each one we have a specific handler defined which is called by the <code class="code docutils literal notranslate"><span class="pre">handleEvents</span></code> call in
the task entry function loop in case the corresponding event is present. To understand what these
handlers are doing, let’s come back to our <em>async</em> API calls.</p>
<p>The most simple one is the <code class="code docutils literal notranslate"><span class="pre">async::execute</span></code> call which utilizes the <code class="code docutils literal notranslate"><span class="pre">_runnableExecutor</span></code>
maintaining a queue of functions that are called within the <code class="code docutils literal notranslate"><span class="pre">RunnableExecutor::handleEvent</span></code>
event handler corresponding to the <code class="code docutils literal notranslate"><span class="pre">ExecuteEventPolicyType</span></code>. When new runnable function is
requested to run in a target task, it is inserted into the queue and the event bit is set as shown
in the simplified code below.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">RunnableExecutor::enqueue</span><span class="p">(</span><span class="n">Runnable</span><span class="o">&amp;</span><span class="w"> </span><span class="n">runnable</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">runnable</span><span class="p">.</span><span class="n">isEnqueued</span><span class="p">())</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">_queue</span><span class="p">.</span><span class="n">enqueue</span><span class="p">(</span><span class="n">runnable</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">_eventPolicy</span><span class="p">.</span><span class="n">setEvent</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The target task gets then unblocked (assuming it was waiting in <code class="code docutils literal notranslate"><span class="pre">waitEvents</span></code>) and once
<em>FreeRTOS</em> schedules it again, the provided runnable function is executed from within the
<code class="code docutils literal notranslate"><span class="pre">handleEvents</span></code> call. Note, that the actual implementation is a little bit more convoluted due
to the heavy use of templates.</p>
<p>The two other <em>async</em> API calls <code class="code docutils literal notranslate"><span class="pre">async::schedule</span></code> and <code class="code docutils literal notranslate"><span class="pre">asyncScheduleAtFixedRate</span></code> are
implemented quite similarly and we will leave it to the reader to have a look at the concrete
implementation. They simply use the second event type <code class="code docutils literal notranslate"><span class="pre">TimerEventPolicyType</span></code> with some clever
logic to calculate proper timeouts for the <code class="code docutils literal notranslate"><span class="pre">xTaskNotifyWait</span></code> call, such that <em>FreeRTOS</em> wakes
us up at the deadline of the next runnable to schedule.</p>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025 Accenture.</p>
  </div>

  <div role="footer_string">
    <p>Documentation from 2025-10-29 13:27:51, official build.</p>

    
      <a href="../../../../../_sources/libs/bsw/asyncFreeRtos/doc/developer/02_runnables.rst.txt" rel="nofollow"> View page source</a>
    

  </div>

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>