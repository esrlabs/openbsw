<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta content="EclipseOpenBSWDocumentation" name="dox_trace_storage" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Diagnostic dispatcher &mdash; Eclipse OpenBSW Documentation  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/rtd_theme_overrides.css?v=6fd0d55b" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/graphviz.css?v=eafc0fe6" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/colors.css?v=3cafd8aa" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/colored_table.css?v=34b816d5" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/header.css?v=e632285e" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/dox_util_colors.css?v=dd14b177" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/dox_trace.css?v=60d3f72c" />

  
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../../../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../../../../_static/copybutton.js?v=f281be69"></script>
        <script src="../../../../../_static/dox_trace.js?v=40719b51"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <link rel="next" title="Connections" href="connection.html" />
    <link rel="prev" title="User Documentation" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../doc/index.html" class="icon icon-home">
            Eclipse OpenBSW Documentation
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Learning</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/learning/overview.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/learning/SysTest/HW_Testing_Guide.html">Hardware Testing Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Guidelines</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/guidelines/conventions/index.html">Coding Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/guidelines/practices.html">Coding Practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/guidelines/3rdparty.html">Third Party Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/guidelines/codeFormatting/index.html">Code Formatting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Platforms</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/platforms/posix/index.html">POSIX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/platforms/s32k148evb/index.html">S32K148 Evaluation Board</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Features</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/features/storage.html">Persistent Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/features/functional_safety.html">Functional Safety</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Software Modules</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../../../doc/modules/common.html">Common</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../../../../doc/modules/common.html#bsw">BSW</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../../async/doc/index.html">async - Asynchronous Execution Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../asyncConsole/doc/index.html">asyncConsole - Asynchronous Console</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../asyncFreeRtos/doc/index.html">asyncFreeRtos</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../asyncImpl/doc/index.html">asyncImpl</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../bsp/doc/index.html">bsp</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../common/doc/index.html">common</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cpp2can/doc/index.html">cpp2can - CAN Abstraction Layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cpp2ethernet/doc/index.html">cpp2ethernet - Ethernet Abstractions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../docan/doc/index.html">docan - Diagnostics over CAN</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../io/doc/index.html">io - IO Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../lifecycle/doc/index.html">lifecycle - App Lifecycle Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../logger/doc/index.html">logger - Logger module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../loggerIntegration/doc/index.html">loggerIntegration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../lwipSocket/doc/index.html">lwipSocket - LwIP v2 Socket Abstraction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../platform/doc/index.html">platform - Platform Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../runtime/doc/index.html">runtime</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stdioConsoleInput/doc/index.html">stdioConsoleInput</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../storage/doc/index.html">storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../timer/doc/index.html">timer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../transport/doc/index.html">transport - Transport Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../transportRouterSimple/doc/index.html">transportRouterSimple</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">uds - Unified Diagnostic Services</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="index.html">User Documentation</a><ul class="current">
<li class="toctree-l5 current"><a class="current reference internal" href="#">Diagnostic dispatcher</a><ul>
<li class="toctree-l6"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l6"><a class="reference internal" href="#diagnostics-configuration">Diagnostics Configuration</a></li>
<li class="toctree-l6"><a class="reference internal" href="#connection-manager">Connection Manager</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="connection.html">Connections</a></li>
<li class="toctree-l5"><a class="reference internal" href="sessions.html">Sessions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../util/doc/index.html">util</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../doc/modules/common.html#bsp">BSP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../doc/modules/common.html#safety">Safety</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/modules/posix.html">Posix</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/modules/s32k1xx.html">S32K1xx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/modules/executables.html">Executables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/modules/mocks.html">Mocks</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../tools/UdsTool/doc/index.html">UdsTool</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../tools/puncover_tool/doc/index.html">Puncover</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../doc/index.html">Eclipse OpenBSW Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../doc/index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../../../doc/modules/common.html">Common</a> &raquo;</li>
        
          <li><a href="../index.html">uds - Unified Diagnostic Services</a> &raquo;</li>
        
          <li><a href="index.html">User Documentation</a> &raquo;</li>
        
        <li>Diagnostic dispatcher</li>
    

    

      <li class="wy-breadcrumbs-aside">

        <!-- DOCUMENT STATUS -->

        

        <!-- DATA CLASSIFICATION -->

        

      </li>

    
  </ul>

  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="diagnostic-dispatcher">
<span id="dispatcher"></span><h1>Diagnostic dispatcher<a class="headerlink" href="#diagnostic-dispatcher" title="Link to this heading"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">DiagDispatcher2</span></code> class manages UDS jobs and handles the dispatching of incoming and outgoing
requests and responses. Messages are dispatched by calling the <code class="docutils literal notranslate"><span class="pre">send()</span></code> function with the
corresponding message as an argument. This approach ensures that incoming and outgoing messages are
queued for sequential processing.</p>
<p>For the dispatcher to function properly, the order in which jobs are added is important.
This ensures that the jobs are organized correctly to build the intended job hierarchy.
The following diagram illustrates an example of such a hierarchy, where the <code class="docutils literal notranslate"><span class="pre">DiagJobRoot</span></code>
node is positioned at the top of the hierarchy:</p>
<p class="plantuml">
<img src="../../../../../_images/plantuml-3f086473708d28ff29258f49f810279e55ec9ab0.png" alt="&#64;startwbs
' Diagnostic Tree
' Length: request_length so far
' Prefix-length: bytes checked by ancestor nodes
' cn: Node checks n-bytes
' Prefix of child node == Request length of parent node (SID bytes match)
* DiagJobRoot
** ReadDataByIdentifier 0x22
*** ReadIdentifierFromMemory 0x22
' different obj instances = different DIDs are checked;
*** ReadIdentifierFromNvStorage 0x22
' ** WriteDataByIdentifier 0x2E
' *** WriteIdentifierToMemory
' *** WriteIdentifierToNvStorage
' ** TesterPresent 0x3E
** RoutineControl 0x31
*** StartRoutine 0x31 0x01
**** RoutineControlJob 0x31 0x01 xx xx

*** StopRoutine 0x31 0x02
**** RoutineControlJobNode 0x31 0x02 xx xx
' Instance returned by RoutineControlJob::getStopRoutine();
*** RequestRoutineResults 0x31 0x03
**** RoutineControlJobNode 0x31 0x03 xx xx
' Instance returned by RoutineControlJob::getRequestRoutineResults();

&#64;endwbs"/>
</p>
<p>In the example provided, there are two direct children of the root job:</p>
<ul class="simple">
<li><p><cite>ReadDataByIdentifier</cite> (<cite>SID</cite> 0x22)</p></li>
<li><p><cite>RoutineControl</cite> (<cite>SID</cite> 0x31)</p></li>
</ul>
<p>with their corresponding children on lower levels of hierarchy. When processing an incoming message
(e.g., a request from a tester), the children are traversed until the child with the corresponding
<cite>SID</cite> is found.</p>
<section id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Link to this heading"></a></h3>
<p>As mentioned earlier, the order in which jobs are added to the dispatcher is crucial: the parent
must be added first, followed by the children, and then the grandchildren, and so on.
<strong>It is still possible to start adding children to a different branch of the hierarchy</strong>;
however, it is important to ensure that the <strong>order of adding parents and children
within the same branch of the hierarchy is maintained</strong>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">ReadDataByIdentifier</span><span class="w"> </span><span class="n">readDataByIdentifier</span><span class="p">;</span>
<span class="n">ReadIdentifierFromMemory</span><span class="w"> </span><span class="n">_read22Cf01</span><span class="p">;</span>
<span class="n">ReadIdentifierFromNvStorage</span><span class="w"> </span><span class="n">_read22Cf02</span><span class="p">;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">createDispatcher</span><span class="p">(</span><span class="n">AbstractDiagnosisConfiguration</span><span class="o">&amp;</span><span class="w"> </span><span class="n">configuration</span><span class="p">,</span>
<span class="w">    </span><span class="n">IDiagSessionManager</span><span class="o">&amp;</span><span class="w"> </span><span class="n">sessionManager</span><span class="p">,</span>
<span class="w">    </span><span class="n">DiagJobRoot</span><span class="o">&amp;</span><span class="w"> </span><span class="n">jobRoot</span><span class="p">,</span>
<span class="w">    </span><span class="o">::</span><span class="n">async</span><span class="o">::</span><span class="n">ContextType</span><span class="w"> </span><span class="n">context</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">DiagDispatcher2</span><span class="w"> </span><span class="n">udsDispatcher</span><span class="p">(</span><span class="n">configuration</span><span class="p">,</span><span class="w"> </span><span class="n">sessionManager</span><span class="p">,</span><span class="w"> </span><span class="n">jobRoot</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// to properly add _read22Cf01 it must be added after readDataByIdentifier!</span>
<span class="w">        </span><span class="n">udsDispatcher</span><span class="p">.</span><span class="n">addAbstractDiagJob</span><span class="p">(</span><span class="n">_read22Cf01</span><span class="p">);</span><span class="w"> </span><span class="c1">// will not be added</span>
<span class="w">        </span><span class="n">udsDispatcher</span><span class="p">.</span><span class="n">addAbstractDiagJob</span><span class="p">(</span><span class="n">readDataByIdentifier</span><span class="p">);</span>
<span class="w">        </span><span class="n">udsDispatcher</span><span class="p">.</span><span class="n">addAbstractDiagJob</span><span class="p">(</span><span class="n">_read22Cf01</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
<p>Properly setting up the CAN communication the ECU will respond to the messages:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>cansend<span class="w"> </span>vcan0<span class="w"> </span>02A#0322CF0100000000
cansend<span class="w"> </span>vcan0<span class="w"> </span>02A#0322CF0200000000
</pre></div>
</div>
</section>
</section>
<section id="diagnostics-configuration">
<h2>Diagnostics Configuration<a class="headerlink" href="#diagnostics-configuration" title="Link to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">DiagnosisConfiguration</span></code> class is passed to the <code class="docutils literal notranslate"><span class="pre">DiagDispatcher</span></code> and stores key information,
including:</p>
<ul class="simple">
<li><p>The number of incoming connections</p></li>
<li><p>The number of outgoing connections (usually 1)</p></li>
<li><p>The maximum number of incoming messages that can be held in the queue</p></li>
<li><p>The UDS address of the server (ECU)</p></li>
<li><p>The bus ID</p></li>
<li><p>Other important details, including boolean flags</p></li>
</ul>
</section>
<section id="connection-manager">
<h2>Connection Manager<a class="headerlink" href="#connection-manager" title="Link to this heading"></a></h2>
<p>The connection manager of type <code class="docutils literal notranslate"><span class="pre">DiagnosticSessionControl</span></code> is another essential parameter passed to
the <code class="docutils literal notranslate"><span class="pre">DiagDispatcher</span></code> during its construction. This manager handles the following tasks:</p>
<ul class="simple">
<li><p>Switching between sessions</p></li>
<li><p>Managing timeouts for extended sessions</p></li>
<li><p>Monitoring the “Tester Present” heartbeat</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025 Accenture.</p>
  </div>

  <div role="footer_string">
    <p>Documentation from 2025-10-29 13:27:52, official build.</p>

    
      <a href="../../../../../_sources/libs/bsw/uds/doc/user/dispatcher.rst.txt" rel="nofollow"> View page source</a>
    

  </div>

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>