<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta content="EclipseOpenBSWDocumentation" name="dox_trace_storage" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>io::IWriter &mdash; Eclipse OpenBSW Documentation  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/rtd_theme_overrides.css?v=6fd0d55b" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/graphviz.css?v=eafc0fe6" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/colors.css?v=3cafd8aa" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/colored_table.css?v=34b816d5" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/header.css?v=e632285e" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/dox_util_colors.css?v=dd14b177" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/dox_trace.css?v=60d3f72c" />

  
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../../../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../../../../_static/copybutton.js?v=f281be69"></script>
        <script src="../../../../../_static/dox_trace.js?v=40719b51"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <link rel="next" title="io::IReader" href="ireader.html" />
    <link rel="prev" title="User Documentation" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../doc/index.html" class="icon icon-home">
            Eclipse OpenBSW Documentation
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Learning</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/learning/overview.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/learning/SysTest/HW_Testing_Guide.html">Hardware Testing Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Guidelines</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/guidelines/conventions/index.html">Coding Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/guidelines/practices.html">Coding Practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/guidelines/3rdparty.html">Third Party Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/guidelines/codeFormatting/index.html">Code Formatting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Platforms</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/platforms/posix/index.html">POSIX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/platforms/s32k148evb/index.html">S32K148 Evaluation Board</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Features</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/features/storage.html">Persistent Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/features/functional_safety.html">Functional Safety</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Software Modules</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../../../doc/modules/common.html">Common</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../../../../doc/modules/common.html#bsw">BSW</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../../async/doc/index.html">async - Asynchronous Execution Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../asyncConsole/doc/index.html">asyncConsole - Asynchronous Console</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../asyncFreeRtos/doc/index.html">asyncFreeRtos</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../asyncImpl/doc/index.html">asyncImpl</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../bsp/doc/index.html">bsp</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../common/doc/index.html">common</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cpp2can/doc/index.html">cpp2can - CAN Abstraction Layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../cpp2ethernet/doc/index.html">cpp2ethernet - Ethernet Abstractions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../docan/doc/index.html">docan - Diagnostics over CAN</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">io - IO Library</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="index.html">User Documentation</a><ul class="current">
<li class="toctree-l5 current"><a class="reference internal" href="index.html#interfaces">Interfaces</a><ul class="current">
<li class="toctree-l6 current"><a class="current reference internal" href="#">io::IWriter</a></li>
<li class="toctree-l6"><a class="reference internal" href="ireader.html">io::IReader</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="index.html#data-structures">Data Structures</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../lifecycle/doc/index.html">lifecycle - App Lifecycle Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../logger/doc/index.html">logger - Logger module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../loggerIntegration/doc/index.html">loggerIntegration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../lwipSocket/doc/index.html">lwipSocket - LwIP v2 Socket Abstraction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../platform/doc/index.html">platform - Platform Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../runtime/doc/index.html">runtime</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../stdioConsoleInput/doc/index.html">stdioConsoleInput</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../storage/doc/index.html">storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../timer/doc/index.html">timer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../transport/doc/index.html">transport - Transport Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../transportRouterSimple/doc/index.html">transportRouterSimple</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../uds/doc/index.html">uds - Unified Diagnostic Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../util/doc/index.html">util</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../doc/modules/common.html#bsp">BSP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../doc/modules/common.html#safety">Safety</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/modules/posix.html">Posix</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/modules/s32k1xx.html">S32K1xx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/modules/executables.html">Executables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc/modules/mocks.html">Mocks</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../tools/UdsTool/doc/index.html">UdsTool</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../tools/puncover_tool/doc/index.html">Puncover</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../doc/index.html">Eclipse OpenBSW Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../doc/index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../../../doc/modules/common.html">Common</a> &raquo;</li>
        
          <li><a href="../index.html">io - IO Library</a> &raquo;</li>
        
          <li><a href="index.html">User Documentation</a> &raquo;</li>
        
        <li>io::IWriter</li>
    

    

      <li class="wy-breadcrumbs-aside">

        <!-- DOCUMENT STATUS -->

        

        <!-- DATA CLASSIFICATION -->

        

      </li>

    
  </ul>

  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="io-iwriter">
<span id="id1"></span><h1>io::IWriter<a class="headerlink" href="#io-iwriter" title="Link to this heading"></a></h1>
<p>The interface <code class="docutils literal notranslate"><span class="pre">IWriter</span></code> is an abstraction to write chunks of bytes with variable size to
a communication channel.</p>
<section id="public-api">
<h2>Public API<a class="headerlink" href="#public-api" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>/**
 * Returns the maximum number of bytes that can be allocated in one allocation
 */
virtual size_t maxSize() const = 0;

/**
 * Allocates a slice of a given number of bytes.
 * \return - Slice of size bytes if underlying queue was not full and size &lt;= maxSize()
 *         - Empty slice otherwise
 *
 * Calling allocate multiple times before calling commit will re-allocate, i.e. a new slice of
 * bytes will be returned and the previous allocation is lost and will not be automatically
 * committed. This can also be used to trim the allocated slice to the right size before
 * committing, thus calling allocate will NOT modify the memory (e.g. zero it).
 */
virtual ::etl::span&lt;uint8_t&gt; allocate(size_t size) = 0;

/**
 * Makes the previously allocated slice available for the reader.
 *
 * Calling commit() makes a new allocation mandatory! The previously allocated slice becomes
 * invalid and must not be used anymore. Calling commit() without a previous successful
 * allocation has no effect.
 */
virtual void commit() = 0;

/**
 * Flushes any buffered data which has not yet been sent.
 *
 * flush() is part of the interface to make subclassing, that implements buffering
 * to e.g. improve bandwidth usage possible. It might have an empty implementation.
 */
virtual void flush() = 0;
</pre></div>
</div>
</section>
<section id="usage-of-api">
<h2>Usage of API<a class="headerlink" href="#usage-of-api" title="Link to this heading"></a></h2>
<p>The interface <code class="docutils literal notranslate"><span class="pre">IWriter</span></code> provides a two step API. The user first needs to <code class="docutils literal notranslate"><span class="pre">allocate</span></code> a
etl::span of bytes. After a successful allocation, the slice can be filled with the
data to be transferred to the reader side of the stream. Calling <code class="docutils literal notranslate"><span class="pre">commit</span></code> makes the data available
to the <a class="reference internal" href="ireader.html#io-ireader"><span class="std std-ref">io::IReader</span></a> connected to the same channel. It also makes the allocated data invalid
- <strong>it must not be modified after committing!</strong></p>
<p class="plantuml">
<a href="../../../../../_images/plantuml-dc892ceda1f260f88282021d5657eb4792dc7beb.png"><img src="../../../../../_images/plantuml-dc892ceda1f260f88282021d5657eb4792dc7beb.png" alt="actor SW
SW -&gt; IWriter : auto d = allocate(size)
alt d.size() &gt; 0 case
    SW -&gt; SW  : fill d
    SW -&gt; IWriter : commit()
end" style="width: 246.0px; height: 312.0px"/></a>
</p>
<section id="example">
<h3>Example<a class="headerlink" href="#example" title="Link to this heading"></a></h3>
<p>The following example shows, how the allocated memory can be used to directly emplace the data
which shall be transferred into it.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
/**
 * Returns the number of bytes available in the CAN hardware buffer, zero if no frame is available.
 * The maximum rx size is 8 bytes.
 */
size_t getCanRxSize();

/**
 * Reads an available CAN frame into a provided object of type CanFrame.
 * \return true if frame was successfully read from hardware, false otherwise.
 */
bool readCanFrame(CanFrame&amp; frame);

/**
 * Tries to read a CAN frame from the hardware and forwards it to the channel represented by a given
 * IWriter.
 * \param writer IWriter to use for sending the frame.
 * \return true if frame has successfully been forwarded, false otherwise.
 */
bool forwardCanFrame(::io::IWriter&amp; writer)
{
    // Check if a frame is available.
    auto const size = getCanRxSize();
    if (size == 0)
    {
        // No frame available.
        return false;
    }
    // Allocate data from channel. We need room for a uint32_t id + data.
    auto data = writer.allocate(sizeof(::etl::be_uint32_t) + size);
    if (data.size() == 0)
    {
        // Couldn&#39;t allocate data.
        return false;
    }
    // The big endian 32bit id comes first in the serialization.
    etl::be_uint32_ext_t id{data.data()};
    data.advance(id.size());
    // We pass the slice data to the frame so that readCanFrame can read the data directly from
    // the hardware to the allocated memory.
    CanFrame frame;
    frame.data = data;

    if (!readCanFrame(frame))
    {
        // Reading the frame from hardware failed.
        return false;
    }
    // We need to update the previously allocated id.
    id = frame.id;
    // Commit data to channel.
    writer.commit();
    return true;
}

</pre></div>
</div>
</section>
</section>
<section id="multiple-producers">
<h2>Multiple Producers<a class="headerlink" href="#multiple-producers" title="Link to this heading"></a></h2>
<p>The two step nature of the interface makes it by default only be usable for a single producer.
Multiple producers using the same writer in parallel lead to race conditions because calling
<code class="docutils literal notranslate"><span class="pre">allocate()</span></code> would return the same memory to multiple users. A wrapper implementation which
turns the two step API into a single call API makes multiple producers possible, however with
slightly different semantics because data you want to write needs to be present before the call
and cannot be put into the allocated memory on the fly.</p>
<section id="id2">
<h3>Example<a class="headerlink" href="#id2" title="Link to this heading"></a></h3>
<p>The following example shows, how with the help of a locking mechanism, the <code class="docutils literal notranslate"><span class="pre">IWriter</span></code> interface
can be used to work with multiple producers.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>bool forwardCanFrame(::io::IWriter&amp; writer)
{
    // Check if a frame is available.
    auto const size = getCanRxSize();
    if (size == 0)
    {
        // No frame available.
        return false;
    }
    // Allocate temporary CanFrame on the stack.
    uint8_t rxData[8];
    CanFrame rxFrame;
    rxFrame.data = rxData;

    // Reading takes too long to surround with lock.
    if (!readCanFrame(rxFrame))
    {
        // Reading the frame from hardware failed.
        return false;
    }
    // RAII lock to block concurrent access to writer.
    Lock lock;
    (void)lock;
    // Allocate data from channel. We need room for a uint32_t id + data.
    auto data = writer.allocate(sizeof(::etl::be_uint32_t) + size);
    if (data.size() == 0)
    {
        // Couldn&#39;t allocate data.
        return false;
    }
    // The big endian 32bit id comes first in the serialization.
    etl::be_uint32_ext_t{data.data()} = rxFrame.id;
    data.advance(sizeof(etl::be_uint32_t));
    // Copy payload to allocated data.
    ::etl::copy(rxFrame.data, data);
    // Commit data to channel.
    writer.commit();
    return true;
}

</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025 Accenture.</p>
  </div>

  <div role="footer_string">
    <p>Documentation from 2025-10-29 13:27:51, official build.</p>

    
      <a href="../../../../../_sources/libs/bsw/io/doc/user/iwriter.rst.txt" rel="nofollow"> View page source</a>
    

  </div>

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>